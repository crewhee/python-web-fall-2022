### Репозиторий к курсу Python Backend, ИТМО 2022

## Домашнее задание
Описать бизнес кейс в котором вам необходимо использовать брокер сообщений

1. Реализовать взаимодействие с RabbitMQ или Apache Kafka
2. Написать тесты на функционал
3. Сделать логирование ключевых частей системы

Идея - есть ряд тяжеловесных задач, по тем или иным причинам обрабатываемых на разных машинах (пусть одна требует вычислений на GPU, а вторая должна загрузить и подготовить большое количество данных для вычислений).

В ответ с сервера приходит `uuid`, по которому можно забрать результат выполнения задачи. 

Схема взаимодействия:
1. Запросы отправляются через FastAPI
2. Далее тяжеловесные запросы попадают в очередь RabbitMQ
3. Существует отдельный worker `reciever_count.py`, который получает задачи из очереди
4. Для того, чтобы хранить результат, используется Redis. В очередь задача попадает с некоторым uuid, его же получает пользователь при отправке задачи. Далее пользователь может запросить у сервера результат выполнения. Если задача не выполнена, то вернется `json` с ошибкой, в противном случае вернется `json` с полем `answer`.

## Остальная информация
Для запуска потребуются: Python 3.9+, Poetry, Docker.

Для установки зависимостей выполнить из корня директории команду:
```[bash]
poetry install
```


Для запуска сервера следует выполнить команду:
```[bash]
uvicorn src.main.main:app --reload
```

Для запуска docker-образов RabbitMQ и Redis следует выполнить команду:
```[bash]
docker compose up
```

Тесты имеет смысл запускать после того, как заработают оба docker-образа. Стоит отметить, что для работы RabbitMQ необходимо установить в ней очередь 'count_queue' и ключ 'count_queue'. Еще необходимо запустить subscriber, для этого следует выполнить:
```[python]
python3 consumer/reciever_count.py
```

Для запуска тестов следует из корневой директории выполнить:
```[python]
python3 -m test.test_integration -v
python3 -m test.test_count_subscriber -v
python3 -m test.test_request -v
```